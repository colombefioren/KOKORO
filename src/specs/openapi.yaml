openapi: 3.1.0
info:
  title: Kokoro API
  version: 1.0.0
  description: Kokoro API powers all core features of the web app.

servers:
  - url: https://kokoro-colombe.vercel.app
    description: Production server
  - url: http://localhost:3000
    description: Local development server

paths:
  /bio:
    post:
      summary: Update the current user's bio
      description: |
        Updates the **bio field** of the currently authenticated user.  
        This endpoint is typically called from the profile settings screen when a user edits their personal description.

        The new bio is a simple text string that appears on the user's profile and may be visible to others in rooms, chats, or social spaces — depending on privacy settings.

        Requires a valid BetterAuth session (sent via session cookie) to verify user identity.
      operationId: updateUserBio
      security:
        - betterAuthSession: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: string
              example: "Just vibing and building projects!"
      responses:
        "200":
          description: Bio updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: string
                    example: Bio updated successfully
        "401":
          description: Unauthorized – The user session is invalid or missing.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: unauthorized
        "500":
          description: Internal Server Error – Database or server issue prevented the update.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Failed to update bio

  /user:
    get:
      summary: Get the currently authenticated user's profile
      description: Retrieves the profile of the currently authenticated user.
      operationId: getUser
      security:
        - betterAuthSession: []
      responses:
        "200":
          description: User profile retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "401":
          description: Unauthorized – The user session is invalid or missing.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: unauthorized
        "404":
          description: User not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: User not found
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Failed to get user

components:
  securitySchemes:
    betterAuthSession:
      type: apiKey
      in: header
      name: Cookie
      description: >
        BetterAuth session cookie (e.g., `better-auth.session=...`).
        This cookie authenticates the user and must be present in all requests requiring authorization.

  schemas:
    User:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        image:
          type: string
          nullable: true
        email:
          type: string
        emailVerified:
          type: boolean
        isOnline:
          type: boolean
          nullable: true
        bio:
          type: string
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        sessions:
          type: array
          items:
            type: object
        accounts:
          type: array
          items:
            type: object
        username:
          type: string
          nullable: true
        displayUsername:
          type: string
          nullable: true
